{% extends "base.html" %}

{% load crispy_forms_tags %}

{% block head %}
    <title>Question {{ question_count }}</title>
{% endblock %}

{% block content %}
    {% if messages %}
        {% for message in messages %}
            <div  {% if message.tags %} class="static alert alert-warning {{ message.tags }} " {% endif %}
                                        role="alert" id="wrong-message"> {{ message }} </div>
        {% endfor %}
    {% endif %}
    <div id="question">
        <div class="container">
            <br/>
            {% autoescape off %}
                {{ pre_text }}
            {% endautoescape %}
        </div>
        <div class="container">
            <br/>
            <pre style="font-size: 1.1em">{{ code }}</pre>
        </div>
        <div class="container">
            <br/>
            {% autoescape off %}
                {{ post_text }}
            {% endautoescape %}
        </div>
        <div class="container">
            <div class="row align-items-end">
                <div class="col-lg-6">
                    <form class="w-100" action="../q/{{ question_id }}" method="post" id="answer-box">
                        {% crispy form %}
                    </form>
                </div>
                <div class="col-lg-6" id="hints">
                    <button type="button" class="btn btn-danger" onclick="giveHint()">Hint</button>
                </div>
            </div>
        </div>
    </div>
    {#    <div id="instructions" style="display: {{ instructions_display }};">#}
    {#        <div class="container">#}
    {#            {% autoescape off %}#}
    {#                {{ instructions }}#}
    {#            {% endautoescape %}#}
    {#            <a href="/q/{{ next_question }}" class="btn btn-primary" role="button">Next</a>#}
    {#        </div>#}
    {#    </div>#}
    <script>
      var hints = {{ hints | safe }};

      $(document).ready(function () {
        $("#wrong-message").fadeTo(2000, 500).slideUp(500, function () {
          $("#wrong-message").slideUp(500);
        });
      });

      function giveHint() {
        // Create hint object and attach it to correct div
        var hint = hints.shift();
        if (hint) {
          $("#hints").prepend(
            $('<div></div>')
              .attr(
                {
                  id: 'hint',
                  "class": 'alert alert-warning',
                  "role": 'alert'
                })
              .text(hint));

          // Set timer interval
          var yourDateToGo = new Date(); //here you're making new Date object
          yourDateToGo.setMilliseconds(yourDateToGo.getMilliseconds() + {{ hint_timeout | safe }});
          //your're setting date in this object 1 day more from now
          //you can change number of days to go by putting any number in place of 1

          // Disable for the specified amount of time
          if ({{ hint_timeout }}) {
            $("#hints").prepend(
              $('<div></div>')
                .attr(
                  {
                    id: 'hint-timer',
                    "class": 'alert alert-warning',
                    "role": 'alert'
                  }
                )
                .text("Hint time remaining")
            );

            var timing = setInterval( // you're making an interval - a thing, that is updating content after number of miliseconds, that you're writing after comma as second parameter
              function () {
                var currentDate = new Date().getTime(); //same thing as above
                var timeLeft = yourDateToGo - currentDate; //difference between time you set and now in miliseconds

                {#var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24)); //conversion miliseconds on days#}
                {#if (days < 10) days = "0" + days; //if number of days is below 10, programm is writing "0" before 9, that's why you see "09" instead of "9"#}
                {#var hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); //conversion miliseconds on hours#}
                {#if (hours < 10) hours = "0" + hours;#}
                var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)); //conversion miliseconds on minutes
                if (minutes < 10) minutes = "0" + minutes;
                var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);//conversion miliseconds on seconds
                if (seconds < 10) seconds = "0" + seconds;

                document.getElementById("hint-timer").innerHTML = minutes + "m " + seconds + "s"; // putting number of days, hours, minutes and seconds in div,
                //which id is countdown

                if (timeLeft <= 0) {
                  clearInterval(timing);
                  document.getElementById("hint-timer").innerHTML = "Time's out"; //if there's no time left, programm in this 2 lines is clearing interval (nothing is counting now)
                  //and you see "It's over" instead of time left
                }
              }, 1000);

            $("#answer-box :input").attr("disabled", true);
            $("#hints :input").attr("disabled", true);
            $("#hint").fadeTo({{ hint_timeout }}, 500).slideUp(500, function () {
              $("#hint").slideUp(500);
              $("#answer-box :input").attr("disabled", false);
              $("#hints :input").attr("disabled", false);
              $("#hint-timer").remove();
            });
          }
        }

        if (hints.length === 0){
          $("#hints :input").attr("disabled", true);
        }
      }

    </script>
{% endblock %}
